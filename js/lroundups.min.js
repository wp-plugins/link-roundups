var LR=LR||{};!function(){var a=jQuery;"undefined"==typeof LR.instances&&(LR.instances={}),LR.CreateCampaignModal=LR.Modal.extend({actions:{Yes:"createCampaign",Cancel:"close"},initialize:function(a){return this.content="Are you sure you want to create a new MailChimp campaign?",LR.Modal.prototype.initialize.apply(this,arguments)},createCampaign:function(){if("undefined"!=typeof this.ongoing&&-1==a.inArray(this.ongoing.state(),["resolved","rejected"]))return!1;var c=this,d={url:ajaxurl,dataType:"json",method:"post",success:function(a){if(c.hideSpinner(),c.close(),a.success){var d=new Backbone.Model(a.data);LR.instances.campaignSuccessModal=new LR.CampaignCreatedModal({model:d}),LR.instances.campaignSuccessModal.render(),b(d)}else new LR.Modal({className:"lroundups-error-modal",content:"Failed to create MailChimp Campaign. Error message:<br /><strong>"+a.message+"</strong>",actions:{Close:"close"}}).render()},error:function(){c.hideSpinner(),c.close(),new LR.Modal({className:"lroundups-error-modal",content:"Something went wrong. Please try again.",actions:{Close:"close"}}).render()}},e={action:"lroundups_create_mailchimp_campaign",security:LR.ajax_nonce,post_id:LR.post_id};return d.data=e,this.showSpinner(),this.ongoing=a.ajax(d),!1}}),LR.CampaignCreatedModal=LR.Modal.extend({actions:{Close:"close"},initialize:function(a){var b=a.model;return this.content='New MailChimp campaign created successfully!<br /><a target="blank" href="https://'+LR.mc_api_endpoint+".admin.mailchimp.com/campaigns/wizard/confirm?id="+b.get("web_id")+'">Click here to edit your campaign in MailChimp.</a>',LR.Modal.prototype.initialize.apply(this,arguments)}});var b=function(b){var c='<p>A MailChimp roundup campaign exists for this post.</p><a class="button" target="blank" href="https://'+LR.mc_api_endpoint+".admin.mailchimp.com/campaigns/wizard/confirm?id="+b.get("web_id")+'">Edit in MailChimp.</a>',d=a("#link-roundups-create-mailchimp-campaign"),e=d.parent();d.remove(),e.html(c)};a(document).ready(function(){if(a("#link-roundups-create-mailchimp-campaign").click(function(){return"undefined"==typeof a(this).attr("disabled")&&("undefined"==typeof LR.instances.campaignModal&&(LR.instances.campaignModal=new LR.CreateCampaignModal),LR.instances.campaignModal.render()),!1}),"undefined"!=typeof LROUNDUPS_DEFAULT_LINK_HTML){a(".lroundups-restore-default-html").click(function(){if(!a(this).is(":disabled")){var b=a("<div />").html(LROUNDUPS_DEFAULT_LINK_HTML).html();return a('[name="lroundups_custom_html"]').val(b),a(this).attr("disabled",!0),!1}});var b=function(){a('[name="lroundups_custom_html"]').val()!==LROUNDUPS_DEFAULT_LINK_HTML&&a(".lroundups-restore-default-html").removeAttr("disabled")};b(),a('[name="lroundups_custom_html"]').on("input propertychange",b)}var c=function(b){var c=a(b).parent().parent(),d=c.data("post-id"),e=c.find(".column-title").text();return'[rounduplink id="'+d+'" title="'+e+'"]'};a("body").on("click",".append-saved-links",function(){return a(".lroundups-link .cb-select").each(function(){a(this).is(":checked")&&send_to_editor(c(this))}),!1}),a("body").on("click","#link_roundups_roundup thead a, #link_roundups_roundup tfoot a",function(){var b=a(this).attr("href"),c=b.match(/(\?)(.*)$/)[2],d=a("#link_roundups_roundup").find('select[name="link_date"]').val();return c+="&link_date="+d+"&action=lroundups_saved_links_list_table_render",a.get(ajaxurl,c).done(function(b){a("#lroundups-display-area").html(b)}),!1}),a("body").on("click","#filter_links",function(){var b=a(this),c=b.parent();b.find(".spinner").css("visibility","visible");var d="link_date="+c.find('select[name="link_date"]').val()+"&action=lroundups_saved_links_list_table_render";return a.post(ajaxurl,d,function(c){a("#lroundups-display-area").html(c),b.find(".spinner").css("visibility","hidden")}),!1}),a("body").on("click","#cb-select-all-1, #cb-select-all-2",function(){a(this).is(":checked")?a(".lroundups-links input[type=checkbox]").each(function(){a(this).prop("checked",!0)}):a(".lroundups-links input[type=checkbox]").each(function(){a(this).prop("checked",!1)})})})}();